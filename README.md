ุงู ูู ุชุฑุฌููโ ูุงู `README.md` ุจู ูุงุฑุณ:  

---

# ๐ ุจูููโุณุงุฒ ูพุงฺฏุงู ุฏุงุฏู SQLite ุจุฑุง `x-ui`

ุงู ุงุณฺฉุฑูพุช **ูพุงฺฏุงู ุฏุงุฏูโ `x-ui` ุฑุง ุจูููโุณุงุฒ** ูโฺฉูุฏุ ูููโูุง ุฑุง ุญุฐู ฺฉุฑุฏู ู ุนููฺฉุฑุฏ ุฑุง ุจูุจูุฏ ูโุจุฎุดุฏ. ูพุณ ุงุฒ ุงุฌุฑุงุ ูุงูโูุง ุงุถุงู ุฏุฑ ูุณุฑ `/etc/x-ui/` ุงุฌุงุฏ ูโุดููุฏ ฺฉู ุงู **ุฑูุชุงุฑ ุทุจุน** ุงุณุช.

## ๐ ูุญููโ ุงุณุชูุงุฏูุ

1. **ุงุณฺฉุฑูพุช ุฑุง ุฐุฎุฑู ฺฉูุฏ** ุฏุฑ ฺฉ ูุงูุ ูุซูุงู `x-ui_optimize_db.py`.
2. **ุจุง ุฏุณุชุฑุณ `root` ุงุฌุฑุง ฺฉูุฏ**:
   ```bash
   git clone https://github.com/dev-ir/x-ui-db.git
   sudo python3 x_ui_optimize_db.py
   ```

## ๐ ุงู ุงุณฺฉุฑูพุช ฺู ฺฉุงุฑูุง ุงูุฌุงู ูโุฏูุฏุ

### 1๏ธโฃ ูุชููู ฺฉุฑุฏู ุณุฑูุณ `x-ui`
```bash
systemctl stop x-ui
```
ุงู ฺฉุงุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ููู ุดุฏู ูพุงฺฏุงู ุฏุงุฏู ุฏุฑ ุญู ุจูููโุณุงุฒ ุถุฑูุฑ ุงุณุช.

### 2๏ธโฃ ุงุฌุงุฏ ฺฉ ูุณุฎูโ ูพุดุชุจุงู ุฏุฑ `/tmp/`
```bash
cp /etc/x-ui/x-ui.db /tmp/x-ui-<timestamp>.db
```
ูุงู ูพุดุชุจุงู ุดุงูู ฺฉ ุจุฑฺุณุจ ุฒูุงู ุฎูุงูุฏ ุจูุฏุ ูุงููุฏ:
```
/tmp/x-ui-1711045600.db
```
ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉูุ ุงู ูุณุฎูโ ูพุดุชุจุงู ุงูฺฉุงู ุจุงุฒฺฏุฑุฏุงู ุฑุง ูุฑุงูู ูโฺฉูุฏ.

### 3๏ธโฃ ุจูููโุณุงุฒ ูพุงฺฏุงู ุฏุงุฏู ุจุง ุฏุณุชูุฑุงุช SQL:

| **ุฏุณุชูุฑ SQL** | **ุชูุถุญ** |
|---------------|-------------|
| `PRAGMA journal_mode=WAL;` | ุญุงูุช WAL (Write-Ahead Logging) ุฑุง ูุนุงู ูโฺฉูุฏ ฺฉู **ุงุฌุงุฒูโ ุฎูุงูุฏู ู ููุดุชู ููุฒูุงู** ุฑุง ูโุฏูุฏ. ุงู ฺฉุงุฑ ุฎุทุง `database locked` ุฑุง ฺฉุงูุด ูโุฏูุฏ. |
| `PRAGMA wal_checkpoint(TRUNCATE);` | ูุงูโูุง WAL ูุฏู ุฑุง ูพุงฺฉ ฺฉุฑุฏู ู ูุดุงุฑ ุฑู ุฏุณฺฉ ุฑุง ฺฉุงูุด ูโุฏูุฏ. |
| `PRAGMA optimize;` | ุดุงุฎุตโูุง ู ฺฉุด ูพุงฺฏุงู ุฏุงุฏู ุฑุง ุจูููโุณุงุฒ ฺฉุฑุฏู ู ุณุฑุนุช ุงุฌุฑุง ุฏุฑุฎูุงุณุชโูุง ุฑุง ุงูุฒุงุด ูโุฏูุฏ. |
| `PRAGMA busy_timeout = 5000;` | ูุฏุช ุฒูุงู ุงูุชุธุงุฑ ูุจู ุงุฒ ููุงุด ุฎุทุง `database locked` ุฑุง ุจู ตฐฐฐ ููโุซุงูู (ต ุซุงูู) ุงูุฒุงุด ูโุฏูุฏ. |
| `PRAGMA read_uncommitted = 1;` | ุงูฺฉุงู ุฎูุงูุฏู ุฏุงุฏูโูุง ุฑุง ุจุฏูู ุงูุชุธุงุฑ ุจุฑุง ูพุงุงู ุชุฑุงฺฉูุดโูุง ุฏฺฏุฑ ูุฑุงูู ูโฺฉูุฏ (ุงูุง ููฺฉู ุงุณุช ุฏุงุฏูโูุง **ุชุฃุฏ ูุดุฏู** ููุงุด ุฏุงุฏู ุดููุฏ). |

### 4๏ธโฃ ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ `x-ui` ูพุณ ุงุฒ ุจูููโุณุงุฒ
```bash
systemctl restart x-ui
```
ูพุณ ุงุฒ ุงู ุนููุงุชุ ูพุงฺฏุงู ุฏุงุฏู ุณุฑุนโุชุฑ ู ูพุงุฏุงุฑุชุฑ ุฎูุงูุฏ ุดุฏ.

## ๐ ฺุฑุง ูุงูโูุง `x-ui.db-shm` ู `x-ui.db-wal` ุงุฌุงุฏ ุดุฏูโุงูุฏุ

ูพุณ ุงุฒ ูุนุงูโุณุงุฒ WALุ ูุงูโูุง **ุงุถุงู** ุฏุฑ ูุณุฑ `/etc/x-ui/` ุธุงูุฑ ูโุดููุฏ:

| **ูุงู** | **ุชูุถุญ** |
|----------|-------------|
| `x-ui.db` | ูุงู ุงุตู ูพุงฺฏุงู ุฏุงุฏู SQLite. |
| `x-ui.db-wal` | ูุงู WAL (Write-Ahead Logging) ฺฉู ุงุจุชุฏุง ุชุบุฑุงุช ุฏุฑ ุขู ุซุจุช ูโุดููุฏ ูุจู ุงุฒ ููุดุชู ุฏุฑ ูุงู ุงุตู. |
| `x-ui.db-shm` | ูุงู ุจุฑุง ูุฏุฑุช ุฏุณุชุฑุณ ููุฒูุงู ุจู ุฏุงุฏูโูุง (Shared Memory). |

**ุงุฌุงุฏ ุงู ูุงูโูุง ฺฉุงููุงู ุทุจุน ุงุณุช ู ูุดุงููโ ุฎุทุง ูุณุช.**

๐ **ูฺฉุชู:** ุงฺฏุฑ `x-ui.db-wal` ุจุด ุงุฒ ุญุฏ ุจุฒุฑฺฏ ุดุฏุ ูโุชูุงูุฏ ุจุง ุงุฌุฑุง ุฏุณุชูุฑ ุฒุฑ ุขู ุฑุง ูพุงฺฉ ฺฉูุฏ:
```sql
PRAGMA wal_checkpoint(TRUNCATE);
```

## โ ุงฺฏุฑ ูุดฺฉู ูพุด ุขูุฏ ฺู ุจุงุฏ ฺฉุฑุฏุ

1. ุณุฑูุณ ุฑุง ูุชููู ฺฉูุฏ:
   ```bash
   systemctl stop x-ui
   ```  
2. ูพุงฺฏุงู ุฏุงุฏู ุฑุง ุงุฒ ูุณุฎูโ ูพุดุชุจุงู ุจุงุฒฺฏุฑุฏุงู ฺฉูุฏ:
   ```bash
   cp /tmp/x-ui-<timestamp>.db /etc/x-ui/x-ui.db
   ```  
3. ุณุฑูุณ ุฑุง ูุฌุฏุฏุงู ุงุฌุฑุง ฺฉูุฏ:
   ```bash
   systemctl start x-ui
   ```

## ๐ ุงุฑุชุจุงุท

ุชูฺฏุฑุงู: [@DSRClient](https://t.me/DSRCLIENT)
